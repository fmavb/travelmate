<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />


	<style>

		.jumbotron{
	    background-color:#2E2D88;
	    color:white;
		}
		/* Adds borders for tabs */
		.tab-content {
		    border-left: 1px solid #ddd;
		    border-right: 1px solid #ddd;
		    border-bottom: 1px solid #ddd;
		    padding: 10px;
		}
		.nav-tabs {
		    margin-bottom: 0;
		}

	    #map {
        width: 50%;
        height: 500px;
        background-color: grey;
      }

	</style>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <title>Home - Travelmate</title>
</head>
<body>
    <div>
		{% if user.is_authenticated %}
            <h1>Welcome to Travelmate, {{ user.username }}!</h1>

        {% else %}
            <h1>Welcome to Travelmate!</h1>
        {% endif %}
    </div>

    <!-- bootstrap dropdown menus -->
    <div class="dropdown-btns"> 
               <p><a href="{% url 'home' %}">Home</a></p>

            	<div class="dropdown">
			  <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			    Trips
			  </button>
			  <ul class="dropdown-menu">
			    <li><a class="dropdown-item" href="{% url 'pop_trips' %}">Popular Trips</a></li>
			    <li><a class="dropdown-item" href="{% url 'recent_trips' %}">Most Recent Trips</a></li>
			  </ul>
			  </div>


			</div>

		<div class="dropdown">
			  <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			    Travellers
			  </button>


			    <ul class="dropdown-menu">
			    	<li><a class="dropdown-item" href="{% url 'best_travelled' %}">The Best-Travelled</a></li>
			    	<li><a class="dropdown-item" href="{% url 'most_active_travellers' %}">The Most Active</a></li>
			    </ul>
			  </div>
		</div>
    </div>

    <div>
        {% if user.is_authenticated %}
            <ul>

                <li><a href="{% url 'my_trips' %}">My Trips</a></li>
                <li><a href="{% url 'add_trip' %}">Add a New Trip</a></li>
                <li><a href="{% url 'settings' %}">Settings</a></li>  
                <li><a href="{% url 'view_profile' %}">View Profile</a></li>
                <li><a href="{% url 'passport' %}">Passport</a></li>
                <li><a href="{% url 'logout' %}?next=/">Logout</a></li>

            </ul>
        {% else %}
        	<a href="{% url 'login' %}">Login</a>
            	

        {% endif %}
    </div>
	<h3>Google Map API Test</h3>
    <div id="map"></div>
	
    <script>
        //currentInfo: Current open InfoWindow
	var currentInfo=null;
      function initMap() {
          //Parse all trips, and homecountry data for current user from JSON
		var data = JSON.parse('{{ json_data | escapejs }}');
		var startLat = parseFloat(data["start"]["lat"]);
		var startLng = parseFloat(data["start"]["lng"]);

		//Init the google map
		var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 5,
          center: {lat: startLat,lng:startLng},
		  mapTypeId: 'terrain'
        });

		//Go trough all trips, and create polylines, attach eventlistener
		var trips = data["trips"];
		for(i = 0; i < trips.length; i++){

			// list of colors to make the line of trips on the map more colourful

			var color_list = [ "#0000ff", "#a52a2a", "#00ffff", "#f817d3", "#008b8b", "#a9a9a9", "#006400", "#bdb76b", "#8b008b", "#556b2f", "#ff8c00", "#9932cc", "#8b0000", "#e9967a", "#9400d3",
			"#ff00ff", "#ffd700", "#008000", "#4b0082", "#f0e68c", "#add8e6", "#e0ffff", "#f0ffff",  "#90ee90", "#d3d3d3", "#ffb6c1", "#ffffe0", "#00ff00", "#ff00ff", "#800000", "#000080", "#808000", "#ffa500", "#000000", "#ffc0cb", "#800080","#800080","#ff0000", "#c0c0c0", "#ffffff", "#ffff00"]

			var current = trips[i];
			var endLat = parseFloat(current["lat"]);
			var endLng = parseFloat(current["lng"]);
			var route = [{lat:startLat,lng:startLng},{lat:endLat,lng:endLng}];
			var line = new google.maps.Polyline({
			  path: route,
			  geodesic: true,
			  strokeColor: color_list[i%color_list.length],
			  strokeOpacity: 1.0,
			  strokeWeight: 3
			});
			if(current.name != "None"){
			    line.setMap(map);
			    bindEvent(line, current["name"], map);
            }
		}
      }

      //Binds eventlistener to individual polyline
	  function bindEvent(polyLine, name, map){
          //Create new InfoWindow
		var infowindow = new google.maps.InfoWindow({
			content: name
		});
		google.maps.event.addListener(polyLine, 'click', function(e) {
		    //If there is a open window, close it
			if (currentInfo) {
				currentInfo.close();
			}
			//Open new InfoWindow
			currentInfo = infowindow;
			infowindow.setPosition(e.latLng);
			infowindow.open(map);
		});
	  }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB-R2PpdSaF_ER0VvYoxoCuiNVWDaZ60m4&callback=initMap">
    </script>


	<footer>
		<div>
                <p><a href="{% url 'about' %}?next=/">About</a></p>
                <p><a href="{% url 'contact' %}">Contact</a></p>
    	</div>
	</footer>



</body>
</html>